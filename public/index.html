<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  <title>Lazy Load</title>
  <style>
    html {
      font-size: 20px;
      line-height: 1.6;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
        Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
    }

    body {
      /* padding-bottom: 200px; */
    }

    header {
      margin: 1rem 3rem 3rem 3rem;
    }

    header h1 {
      font-size: 3rem;
      line-height: 1.2;
      font-weight: 300;
      color: #999;
    }

    header h2 {
      font-size: 1.5rem;
      line-height: 1.2;
      font-weight: 300;
      color: cornflowerblue;
    }

    main {
      display: grid;
      grid-template-columns: 1fr ;
      grid-gap: 1rem;
      width: 80vw;
      margin: 3rem ;
      grid-template-rows: auto;
    }

    


    main figure {
      width: 50%;
      height: 50%;
      max-width: 50%;
    }

    footer {
      background-color: #aaa;
      color: #333;
      font-size: 1rem;
      font-weight: 300;
      padding: 1rem 3rem 3rem 3rem;
      margin-top: 0;
    }
  </style>
</head>

<body>
  <header>
    <h1>Lazy Loading</h1>
    <h2>Loading images by Intersection Observer</h2>
  </header>
  <main >

  </main>
  <footer>
    <p>The Footer</p>
  </footer>
  <script>
    
    document.addEventListener("DOMContentLoaded", () => {
      let options = {
        root: null,
        rootMargins: "0px",
        threshold: 0.5
      };
      const observer = new IntersectionObserver(handleIntersect, options);
      observer.observe(document.querySelector("footer"));
      getData();//Loading Initial Data

    });
    function handleIntersect(entries) {
      if (entries[0].isIntersecting) {
        console.warn("something is intersecting with the viewport");
        getData(); //Observing viewport with Intersection Observer
      }
    }
    function getData() {
      
     //fetching data
      let main = document.querySelector("main");
      console.log("fetch data");
      fetch("https://avatars.dicebear.com/api/avataaars/:a"+Math.random()+".svg")
        .then(response => response.text())
        .then((response) => {
          console.log("In console "+response);
            let fig = document.createElement("figure");
            fig.innerHTML=response;
            console.log("fig"+fig);
            main.appendChild(fig);
          
        });
      
    }
  </script>

</body>

</html>